<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portafolio 3D | Alex Dev</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;500;800&display=swap" rel="stylesheet">
    
    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
                "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <style>
        body { 
            background-color: #050505; 
            color: #e2e8f0; 
            font-family: 'Inter', sans-serif;
            overflow: hidden; 
        }
        
        #canvas-container { 
            width: 100%; height: 100vh; 
            position: fixed; top: 0; right: 0; 
            z-index: 0; 
        }

        /* INTERFAZ PRINCIPAL */
        #main-interface {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 20;
            background: rgba(5, 5, 5, 0.98);
            overflow-y: auto; 
            transition: transform 0.8s cubic-bezier(0.86, 0, 0.07, 1), opacity 0.8s ease-in-out;
        }

        .interface-hidden {
            transform: translateY(-100%);
            opacity: 0;
            pointer-events: none;
        }

        /* ETIQUETA FLOTANTE */
        #object-label {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: #00ffff;
            padding: 6px 12px;
            border-radius: 4px;
            border-left: 3px solid #00ffff;
            font-size: 14px;
            font-weight: 600;
            pointer-events: none; 
            opacity: 0; 
            transition: opacity 0.15s ease;
            z-index: 15;
            transform: translate(15px, 15px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* TARJETAS */
        .ref-card {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.05);
            transition: all 0.3s ease;
        }
        .ref-card:hover {
            border-color: #ef4444;
            background: rgba(255,255,255,0.08);
            transform: translateY(-5px);
        }

        /* BOTONES */
        .hud-btn {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 10px 20px;
            border-radius: 9999px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex; align-items: center; gap: 8px;
        }
        .hud-btn:hover { background: rgba(220, 38, 38, 0.8); border-color: #ef4444; }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0a0a0a; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
    </style>
</head>
<body class="font-sans antialiased">

    <div id="object-label">Objeto</div>

    <!-- AUDIO SECRETOS -->
    <audio id="freddy-honk" src="https://www.myinstants.com/media/sounds/honk-sound.mp3"></audio>

    <!-- INTERFAZ HTML -->
    <div id="main-interface">
        <div class="container mx-auto px-6 py-12 max-w-6xl">
            
            <header class="flex flex-col md:flex-row items-center gap-10 mb-16 pt-10 animate-fade-in">
                <div class="relative group">
                    <div class="w-48 h-48 rounded-full overflow-hidden border-4 border-red-600 shadow-[0_0_40px_rgba(220,38,38,0.5)]">
                        <img src="./assets/perfil.jpg" onerror="this.src='https://api.dicebear.com/9.x/micah/svg?seed=Alex'" alt="Foto de Alex" class="w-full h-full object-cover bg-slate-800">
                    </div>
                </div>
                <div class="text-center md:text-left">
                    <h1 class="text-7xl font-black text-white tracking-tighter mb-4">
                        ALEX<span class="text-red-600">.DEV</span>
                    </h1>
                    <p class="text-xl text-slate-400 max-w-2xl font-light">
                        Desarrollador Creativo & Artista 3D.
                    </p>
                    <div class="flex gap-4 justify-center md:justify-start mt-6">
                        <a href="#" class="p-2 bg-slate-800 rounded-full hover:bg-red-600 transition"><i data-lucide="github"></i></a>
                        <a href="#" class="p-2 bg-slate-800 rounded-full hover:bg-blue-600 transition"><i data-lucide="linkedin"></i></a>
                    </div>
                </div>
            </header>

            <section class="mb-16">
                <div class="flex items-center gap-4 mb-6 border-b border-slate-800 pb-4">
                    <div class="p-2 bg-red-900/20 rounded-lg"><i data-lucide="user" class="text-red-500 w-6 h-6"></i></div>
                    <h2 class="text-3xl font-bold text-white">Sobre Mí</h2>
                </div>
                <p class="text-slate-300 leading-relaxed text-lg">
                    Soy un apasionado de la tecnología con un enfoque en crear experiencias web inmersivas. 
                    Este portafolio combina Blender y WebGL.
                </p>
            </section>

            <section class="mb-16">
                <div class="flex items-center gap-4 mb-6 border-b border-slate-800 pb-4">
                    <div class="p-2 bg-red-900/20 rounded-lg"><i data-lucide="cpu" class="text-red-500 w-6 h-6"></i></div>
                    <h2 class="text-3xl font-bold text-white">Habilidades</h2>
                </div>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div class="bg-slate-900 p-4 rounded-lg border border-slate-800 text-center hover:border-red-500 transition"><i data-lucide="box" class="mx-auto mb-2 text-orange-400"></i> Blender</div>
                    <div class="bg-slate-900 p-4 rounded-lg border border-slate-800 text-center hover:border-yellow-500 transition"><i data-lucide="code-2" class="mx-auto mb-2 text-yellow-400"></i> JavaScript</div>
                    <div class="bg-slate-900 p-4 rounded-lg border border-slate-800 text-center hover:border-blue-500 transition"><i data-lucide="layout" class="mx-auto mb-2 text-blue-400"></i> CSS</div>
                    <div class="bg-slate-900 p-4 rounded-lg border border-slate-800 text-center hover:border-green-500 transition"><i data-lucide="globe" class="mx-auto mb-2 text-green-400"></i> Three.js</div>
                </div>
            </section>

            <section class="mb-20">
                <div class="flex items-center gap-4 mb-8 border-b border-slate-800 pb-4">
                    <div class="p-2 bg-red-900/20 rounded-lg"><i data-lucide="layers" class="text-red-500 w-6 h-6"></i></div>
                    <h2 class="text-3xl font-bold text-white">Proyectos & Assets</h2>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <!-- PELUCHE -->
                    <article class="ref-card p-4 rounded-xl cursor-pointer group">
                        <div class="aspect-square bg-slate-800 rounded-lg mb-4 overflow-hidden relative border border-slate-700">
                            <!-- FOTO DE TU PELUCHE AQUÍ -->
                            <img src="./assets/freddy_blender.png" onerror="this.src='https://placehold.co/600x600?text=Foto+Peluche'" class="w-full h-full object-contain p-2 group-hover:scale-110 transition duration-500">
                            <div class="absolute top-2 right-2 bg-red-600 text-white text-xs px-2 py-1 rounded font-bold">FNAF</div>
                        </div>
                        <h3 class="text-xl font-bold text-white group-hover:text-red-500 transition">Peluche Freddy</h3>
                        <p class="text-sm text-slate-400 mt-2">Modelado orgánico low-poly.</p>
                    </article>
                    
                    <!-- SETUP -->
                    <article class="ref-card p-4 rounded-xl cursor-pointer group">
                        <div class="aspect-square bg-slate-800 rounded-lg mb-4 overflow-hidden relative border border-slate-700">
                            <!-- FOTO DE TU ESCRITORIO AQUÍ -->
                            <img src="./assets/escritorio_blender.png" onerror="this.src='https://placehold.co/600x600?text=Foto+Escritorio'" class="w-full h-full object-cover group-hover:scale-110 transition duration-500 opacity-80 group-hover:opacity-100">
                        </div>
                        <h3 class="text-xl font-bold text-white group-hover:text-red-500 transition">Setup Hard Surface</h3>
                        <p class="text-sm text-slate-400 mt-2">Escritorio modelado en Blender.</p>
                    </article>

                    <!-- POSTERS -->
                    <article class="ref-card p-4 rounded-xl cursor-pointer group">
                        <div class="aspect-square bg-slate-800 rounded-lg mb-4 overflow-hidden relative border border-slate-700">
                            <!-- FOTO DE TUS POSTERS AQUÍ -->
                            <img src="./assets/posters_blender.png" onerror="this.src='https://placehold.co/600x600?text=Foto+Posters'" class="w-full h-full object-cover group-hover:scale-110 transition duration-500 opacity-80 group-hover:opacity-100">
                        </div>
                        <h3 class="text-xl font-bold text-white group-hover:text-red-500 transition">Texturas UV</h3>
                        <p class="text-sm text-slate-400 mt-2">Mapeo de texturas personalizadas.</p>
                    </article>
                </div>
            </section>

            <div class="text-center pb-24">
                <p id="loading-status" class="mb-6 text-sm font-mono text-slate-500 animate-pulse">CARGANDO RECURSOS 3D...</p>
                <button id="enter-btn" disabled class="group relative inline-flex items-center justify-center px-16 py-6 text-lg font-bold text-white transition-all duration-200 bg-red-600 font-pj rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-600 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-red-700 hover:scale-105 shadow-[0_0_60px_rgba(220,38,38,0.4)]">
                    <span class="relative flex items-center gap-3 text-xl tracking-wide">
                        EXPLORAR MODELO 3D <i data-lucide="play-circle"></i>
                    </span>
                </button>
            </div>
        </div>
    </div>

    <!-- HUD 3D -->
    <div id="hud-controls" class="fixed top-6 left-6 z-10 hidden">
        <button id="back-btn" class="hud-btn">
            <i data-lucide="arrow-left" class="w-4 h-4"></i> VOLVER AL MENÚ
        </button>
        <!-- Mensaje de ayuda -->
        <div class="fixed bottom-6 left-1/2 transform -translate-x-1/2 text-white/50 text-sm bg-black/50 px-4 py-2 rounded-full backdrop-blur-sm pointer-events-none text-center">
            Clic en la pantalla: Video | Clic en el poster de Freddy: Sorpresa
        </div>
    </div>

    <div id="canvas-container"></div>

    <video id="monitor-video" loop playsinline preload="auto" crossOrigin="anonymous" style="display:none">
        <source src="./assets/video.mp4" type="video/mp4">
        <source src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4" type="video/mp4">
    </video>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
        import { RoomEnvironment } from 'three/addons/environments/RoomEnvironment.js'; 

        let scene, camera, renderer, controls, model;
        let particlesMesh;
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();
        const label = document.getElementById('object-label');
        const uiLayer = document.getElementById('main-interface');
        const enterBtn = document.getElementById('enter-btn');
        const hudControls = document.getElementById('hud-controls');
        const backBtn = document.getElementById('back-btn');
        const loadingStatus = document.getElementById('loading-status');
        const honkSound = document.getElementById('freddy-honk');
        
        // VIDEO
        const video = document.getElementById('monitor-video');
        video.pause(); 
        const videoTexture = new THREE.VideoTexture(video);
        videoTexture.minFilter = THREE.LinearFilter;
        videoTexture.format = THREE.RGBAFormat;
        videoTexture.flipY = false; 
        const videoMaterial = new THREE.MeshBasicMaterial({ map: videoTexture, side: THREE.FrontSide, toneMapped: false });

        // INICIALIZACIÓN
        const container = document.getElementById('canvas-container');
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0x050505); 

        // CÁMARA (Posición fija solicitada)
        camera = new THREE.PerspectiveCamera(45, container.offsetWidth / container.offsetHeight, 0.1, 1000);
        camera.position.set(70, -15,-2.5); 

        renderer = new THREE.WebGLRenderer({ antialias: true, alpha: false });
        renderer.setSize(container.offsetWidth, container.offsetHeight);
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        renderer.outputColorSpace = THREE.SRGBColorSpace;
        renderer.toneMapping = THREE.ACESFilmicToneMapping; 
        renderer.toneMappingExposure = 1.0; 
        container.appendChild(renderer.domElement);

        const pmremGenerator = new THREE.PMREMGenerator(renderer);
        scene.environment = pmremGenerator.fromScene(new RoomEnvironment(), 0.04).texture;

        const ambientLight = new THREE.AmbientLight(0xffffff, 0.3);
        scene.add(ambientLight);
        const dirLight = new THREE.DirectionalLight(0xffffff, 1.5);
        dirLight.position.set(5, 8, 5);
        dirLight.castShadow = true;
        scene.add(dirLight);

        controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.enablePan = false; 
        controls.minDistance = 2;
        controls.maxDistance = 12;
        controls.maxPolarAngle = Math.PI / 2 - 0.05; 
        controls.target.set(-2, -2, 0);

        // PARTÍCULAS
        function createParticles() {
            const count = 200;
            const geom = new THREE.BufferGeometry();
            const pos = new Float32Array(count * 3);
            for(let i=0; i<count*3; i++) pos[i] = (Math.random()-0.5)*15;
            geom.setAttribute('position', new THREE.BufferAttribute(pos, 3));
            const mat = new THREE.PointsMaterial({ size: 0.04, color: 0x4ade80, transparent: true, opacity: 0.4 });
            particlesMesh = new THREE.Points(geom, mat);
            scene.add(particlesMesh);
        }
        createParticles();

        // CARGA GLB
        let isModelLoaded = false;
        const loader = new GLTFLoader();
        loader.load('assets/setup.glb', (gltf) => {
            model = gltf.scene;
            model.traverse((child) => {
                if (child.isMesh) {
                    child.castShadow = true; child.receiveShadow = true;
                    
                    // DETECCIÓN DE PANTALLA
                    if (child.name.includes('Screen') || (child.material && child.material.name.includes('Screen'))) {
                        child.material = videoMaterial;
                        child.name = "Pantalla Interactiva"; 
                        child.userData.isScreen = true;
                    }
                    
                    if (child.material && child.material.name.toLowerCase().includes('glow')) {
                        child.material.emissive = child.material.color;
                        child.material.emissiveIntensity = 2;
                        child.material.toneMapped = false;
                    }
                    
                    // DETECCIÓN DEL PÓSTER
                    // Busca materiales o nombres que digan "poster"
                    if (child.material && (child.material.name.toLowerCase().includes('poster') || child.name.toLowerCase().includes('poster'))) {
                        child.userData.isFreddyPoster = true;
                        child.name = "Póster Freddy";
                    }
                }
            });
            const box = new THREE.Box3().setFromObject(model);
            const center = box.getCenter(new THREE.Vector3());
            model.position.sub(center);
            scene.add(model);

            isModelLoaded = true;
            loadingStatus.innerHTML = "SISTEMA LISTO <span class='text-green-500'>●</span>";
            loadingStatus.classList.remove('animate-pulse');
            enterBtn.removeAttribute('disabled');
            enterBtn.classList.add('animate-bounce');
        }, undefined, (e) => {
            console.error(e);
            loadingStatus.innerText = "Error cargando modelo";
            loadingStatus.classList.add('text-red-500');
        });

        // EVENTOS INTERFAZ
        enterBtn.addEventListener('click', () => {
            if (!isModelLoaded) return;
            uiLayer.classList.add('interface-hidden');
            hudControls.classList.remove('hidden');
        });

        backBtn.addEventListener('click', () => {
            uiLayer.classList.remove('interface-hidden');
            hudControls.classList.add('hidden');
        });

        // HOVER
        window.addEventListener('mousemove', (event) => {
            if (!uiLayer.classList.contains('interface-hidden')) return;

            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(scene.children, true);

            if (intersects.length > 0) {
                const obj = intersects[0].object;
                if (obj.isMesh) {
                    let name = obj.name.replace(/_/g, ' ').replace(/[0-9]/g, '');
                    if(name === 'Plane') name = 'Suelo';
                    
                    label.innerText = name;
                    label.style.opacity = '1';
                    label.style.left = (event.clientX + 15) + 'px';
                    label.style.top = (event.clientY + 15) + 'px';
                    
                    const isInteractive = obj.userData.isScreen || obj.userData.isFreddyPoster;
                    document.body.style.cursor = isInteractive ? 'pointer' : 'default';
                    
                    if (obj.userData.isFreddyPoster) {
                        label.style.color = '#ef4444'; 
                        label.style.borderColor = '#ef4444';
                    } else {
                        label.style.color = '#00ffff';
                        label.style.borderColor = '#00ffff';
                    }
                }
            } else {
                label.style.opacity = '0';
                document.body.style.cursor = 'default';
            }
        });

        // CLIC (INTERACCIONES)
        window.addEventListener('click', (event) => {
            if (!uiLayer.classList.contains('interface-hidden')) return;

            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(scene.children, true);

            if (intersects.length > 0) {
                const obj = intersects[0].object;

                // 1. PANTALLA -> VIDEO
                if (obj.userData.isScreen) {
                    if (video.paused) {
                        video.play();
                        obj.material.emissiveIntensity = 1; 
                    } else {
                        video.pause();
                    }
                }
                
                // 2. PÓSTER FREDDY -> HONK
                if (obj.userData.isFreddyPoster) {
                    honkSound.currentTime = 0; 
                    honkSound.volume = 0.5;
                    honkSound.play().catch(e => console.log("Error sonido"));
                    
                    const oldHex = obj.material.emissive.getHex();
                    obj.material.emissive.setHex(0xffffff); 
                    setTimeout(() => { 
                        if(obj.material) obj.material.emissive.setHex(oldHex); 
                    }, 100);
                }
            }
        });

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            if (particlesMesh) {
                particlesMesh.rotation.y += 0.001;
                particlesMesh.position.y = Math.sin(Date.now() * 0.0005) * 0.2;
            }
            renderer.render(scene, camera);
        }
        animate();

        window.addEventListener('resize', () => {
            camera.aspect = container.offsetWidth / container.offsetHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.offsetWidth, container.offsetHeight);
        });

        lucide.createIcons();
    </script>
</body>
</html>